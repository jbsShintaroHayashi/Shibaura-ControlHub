<UserControl x:Class="Shibaura_ControlHub.Views.CameraView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:Shibaura_ControlHub.Views"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:conv="clr-namespace:Shibaura_ControlHub.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="1280" d:DesignWidth="1920">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <conv:IntEqualityConverter x:Key="IntEqualityConverter"/>
        <conv:PresetStateConverter x:Key="PresetStateConverter"/>
        <conv:EqualityConverter x:Key="EqualityConverter"/>
        
        <!-- トラッキングボタンスタイル -->
        <Style x:Key="TrackingButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsTrackingOn}" Value="True">
                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                    <Setter Property="Foreground" Value="White"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- カメラ選択ボタンスタイル（カメラ1用） -->
        <Style x:Key="Camera1SelectButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Style.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <MultiBinding Converter="{StaticResource EqualityConverter}">
                            <Binding Path="SelectedCamera"/>
                            <Binding Path="Camera1"/>
                        </MultiBinding>
                    </DataTrigger.Binding>
                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                    <Setter Property="Foreground" Value="White"/>
                </DataTrigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- カメラ選択ボタンスタイル（カメラ2用） -->
        <Style x:Key="Camera2SelectButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Style.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <MultiBinding Converter="{StaticResource EqualityConverter}">
                            <Binding Path="SelectedCamera"/>
                            <Binding Path="Camera2"/>
                        </MultiBinding>
                    </DataTrigger.Binding>
                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                    <Setter Property="Foreground" Value="White"/>
                </DataTrigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- カメラ選択ボタンスタイル（カメラ3用） -->
        <Style x:Key="Camera3SelectButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Style.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <MultiBinding Converter="{StaticResource EqualityConverter}">
                            <Binding Path="SelectedCamera"/>
                            <Binding Path="Camera3"/>
                        </MultiBinding>
                    </DataTrigger.Binding>
                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                    <Setter Property="Foreground" Value="White"/>
                </DataTrigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- プリセットセクションテンプレート -->
        <DataTemplate x:Key="PresetSectionTemplate">
            <StackPanel Margin="0,0,0,10">
                <TextBlock Text="プリセット" Style="{StaticResource SectionHeaderStyle}"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- プリセット選択ボタン -->
                    <ItemsControl Grid.Column="0" ItemsSource="{Binding CameraPresets}" Margin="0,0,10,0">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2" Rows="4"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Content="{Binding Number}"
                                        Tag="{Binding Number}"
                                        Command="{Binding DataContext.SelectPresetCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding Number}"
                                        Margin="6,5,6,5">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource BasePresetButtonStyle}">
                                            <Style.Triggers>
                                                <!-- 選択されているが呼び出されていない（オレンジ） -->
                                                <DataTrigger Value="1">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding Converter="{StaticResource PresetStateConverter}">
                                                            <Binding Path="DataContext.SelectedPresetNumber" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                            <Binding Path="DataContext.CalledPresetNumber" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                            <Binding RelativeSource="{RelativeSource Self}" Path="Tag"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter Property="Background" Value="#F59E0B"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                                <!-- 選択されていて呼び出し済み（濃い青） -->
                                                <DataTrigger Value="2">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding Converter="{StaticResource PresetStateConverter}">
                                                            <Binding Path="DataContext.SelectedPresetNumber" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                            <Binding Path="DataContext.CalledPresetNumber" RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                                            <Binding RelativeSource="{RelativeSource Self}" Path="Tag"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- 登録モード切替ボタン -->
                    <Grid Grid.Column="1" VerticalAlignment="Top">
                        <Button Content="登録" FontSize="13" FontWeight="Bold"
                                Command="{Binding TogglePresetRegisterModeCommand}"
                                Padding="14,9" Margin="6,5,6,0" Height="82" MinHeight="82" MaxHeight="82" HorizontalAlignment="Stretch">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsPresetRegisterMode}" Value="True">
                                            <Setter Property="Background" Value="#F59E0B"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="Content" Value="登録中"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Grid>
            </StackPanel>
        </DataTemplate>
        
        <!-- 通常カメラ用テンプレート -->
        <DataTemplate x:Key="NormalCameraTemplate">
            <StackPanel>
                <ContentControl Content="{Binding}" ContentTemplate="{StaticResource PresetSectionTemplate}"/>
            </StackPanel>
        </DataTemplate>
        
        <!-- AIカメラ用テンプレート -->
        <DataTemplate x:Key="AiCameraTemplate">
            <StackPanel>
                <ContentControl Content="{Binding}" ContentTemplate="{StaticResource PresetSectionTemplate}"/>
            </StackPanel>
        </DataTemplate>
        
        <!-- 方向キー用 テキストボタンスタイル（ローカル用） -->
        <Style x:Key="TriangleButtonStyleLocal" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Width" Value="64"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Background" Value="{StaticResource PanelBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="10"
                                BorderThickness="1"
                                BorderBrush="{StaticResource BorderBrush}">
                            <Border.Effect>
                                <DropShadowEffect Color="#000000" Direction="270" ShadowDepth="2" Opacity="0.3" BlurRadius="4"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#2D2D30"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="#1E1E1E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- カメラ操作ボタンスタイル（押下エフェクト付き） -->
        <Style x:Key="CameraControlButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Width" Value="64"/>
            <Setter Property="Height" Value="64"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="IsManipulationEnabled" Value="False"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="False"/>
            <Setter Property="Stylus.IsTapFeedbackEnabled" Value="False"/>
            <Setter Property="Stylus.IsPressAndHoldEnabled" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                BorderThickness="0"
                                BorderBrush="{StaticResource PrimaryBrush}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#2D2D30"/>
                                <Setter Property="Foreground" Value="#6B6B6B"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 中央ボタンスタイル -->
        <Style x:Key="CenterButtonStyle" TargetType="Button" BasedOn="{StaticResource CameraControlButtonStyle}">
        </Style>
    </UserControl.Resources>
    <StackPanel Margin="12">
        <TextBlock Text="カメラ制御" Style="{StaticResource PageTitleStyle}"/>
        
        <!-- カメラ選択 -->
        <TextBlock Text="カメラ選択" Style="{StaticResource SectionHeaderStyle}"/>
        <Grid Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="50"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="50"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="50"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="1" Content="PTZカメラ1(AI)" 
                    Command="{Binding SelectCameraCommand}"
                    Style="{StaticResource Camera1SelectButtonStyle}"
                    FontSize="14" FontWeight="Bold" 
                    Padding="8,10" 
                    Margin="2"
                    IsEnabled="{Binding Camera1Enabled}" Click="Button_Click">
                <Button.CommandParameter>
                    <Binding Path="Camera1"/>
                </Button.CommandParameter>
            </Button>

            <Button Grid.Column="3" Content="PTZカメラ2" 
                    Command="{Binding SelectCameraCommand}"
                    Style="{StaticResource Camera2SelectButtonStyle}"
                    FontSize="14" FontWeight="Bold" 
                    Padding="8,10" 
                    Margin="2"
                    IsEnabled="{Binding Camera2Enabled}">
                <Button.CommandParameter>
                    <Binding Path="Camera2"/>
                </Button.CommandParameter>
            </Button>

            <Button Grid.Column="5" Content="PTZカメラ3" 
                    Command="{Binding SelectCameraCommand}"
                    Style="{StaticResource Camera3SelectButtonStyle}"
                    FontSize="14" FontWeight="Bold" 
                    Padding="8,10" 
                    Margin="2"
                    IsEnabled="{Binding Camera3Enabled}">
                <Button.CommandParameter>
                    <Binding Path="Camera3"/>
                </Button.CommandParameter>
            </Button>
        </Grid>
        
        <!-- 操作ボタン領域 -->
        <Grid Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <TextBlock Grid.Row="0" Text="カメラ移動" Style="{StaticResource SectionHeaderStyle}"/>
            
            <Grid Grid.Row="1" Margin="0,0,0,6">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 9方向ボタン領域 -->
                <Viewbox Grid.Column="1" Stretch="Uniform" MaxWidth="240" MaxHeight="240" HorizontalAlignment="Center">
                <Grid Width="240" Height="240">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 9方向ボタン -->
                    <!-- 左上 -->
                    <Button Grid.Row="0" Grid.Column="0" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="UpLeft"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="◤" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 上 -->
                    <Button Grid.Row="0" Grid.Column="1" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="Up"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="▲" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 右上 -->
                    <Button Grid.Row="0" Grid.Column="2" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="UpRight"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="◥" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 左 -->
                    <Button Grid.Row="1" Grid.Column="0" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="Left"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="◀" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 中央 -->
                    <Button Grid.Row="1" Grid.Column="1" Style="{StaticResource CenterButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="Center"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="■" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 右 -->
                    <Button Grid.Row="1" Grid.Column="2" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="Right"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="▶" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 左下 -->
                    <Button Grid.Row="2" Grid.Column="0" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="DownLeft"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="◣" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 下 -->
                    <Button Grid.Row="2" Grid.Column="1" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="Down"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="▼" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                    <!-- 右下 -->
                    <Button Grid.Row="2" Grid.Column="2" Style="{StaticResource CameraControlButtonStyle}" Command="{Binding MoveCameraCommand}" CommandParameter="DownRight"
                            PreviewMouseDown="MoveButton_PreviewMouseDown" PreviewMouseUp="MoveButton_PreviewMouseUp"
                            PreviewTouchDown="MoveButton_PreviewTouchDown" PreviewTouchUp="MoveButton_PreviewTouchUp"
                            LostTouchCapture="MoveButton_LostTouchCapture">
                        <TextBlock Text="◢" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Button>
                </Grid>
                </Viewbox>

                <!-- ズーム＋トラッキング（右側） -->
                <Grid Grid.Column="2" VerticalAlignment="Center" Margin="24,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- ズームボタン（縦並び）- Viewboxの外で固定サイズ -->
                    <StackPanel Grid.Column="0" Orientation="Vertical" VerticalAlignment="Center">
                    <Button Command="{Binding ZoomCameraCommand}"
                                CommandParameter="In" Width="80" Height="56" Margin="0,0,0,10" Padding="0"
                                PreviewMouseDown="ZoomButton_PreviewMouseDown" PreviewMouseUp="ZoomButton_PreviewMouseUp"
                                PreviewTouchDown="ZoomButton_PreviewTouchDown" PreviewTouchUp="ZoomButton_PreviewTouchUp"
                                LostTouchCapture="ZoomButton_LostTouchCapture"
                                Style="{StaticResource CameraControlButtonStyle}">
                        <Button.Content>
                                <TextBlock Text="＋" FontSize="24" FontWeight="Bold" Foreground="White"/>
                        </Button.Content>
                    </Button>
                    <Button Command="{Binding ZoomCameraCommand}"
                                CommandParameter="Out" Width="80" Height="56" Padding="0"
                                PreviewMouseDown="ZoomButton_PreviewMouseDown" PreviewMouseUp="ZoomButton_PreviewMouseUp"
                                PreviewTouchDown="ZoomButton_PreviewTouchDown" PreviewTouchUp="ZoomButton_PreviewTouchUp"
                                LostTouchCapture="ZoomButton_LostTouchCapture"
                                Style="{StaticResource CameraControlButtonStyle}">
                        <Button.Content>
                                <TextBlock Text="－" FontSize="24" FontWeight="Bold" Foreground="White"/>
                        </Button.Content>
                        </Button>
                    </StackPanel>

                    <!-- トラッキング（ズームの横 / カメラ1のみ表示） -->
                    <Viewbox Grid.Column="1" Stretch="Uniform" MaxWidth="240" MaxHeight="120" VerticalAlignment="Center" Margin="32,0,0,0">
                    <Grid Visibility="{Binding IsCamera1Selected, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- ラベル（ボタンと同じ行） -->
                        <TextBlock Grid.Column="0"
                                   Text="トラッキング"
                                   Style="{StaticResource SectionHeaderStyle}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0"
                                   TextAlignment="Right"/>

                        <!-- オン/オフ -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                            <Button Content="オン" Width="100" Height="56" Margin="0,0,12,0"
                                    Command="{Binding ToggleAiTrackingCommand}" CommandParameter="On"
                                    Style="{StaticResource TrackingButtonStyle}"/>
                            <Button Content="オフ" Width="100" Height="56"
                                    Command="{Binding ToggleAiTrackingCommand}" CommandParameter="Off">
                        <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Height" Value="56"/>
                                        <Setter Property="Width" Value="100"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsTrackingOn}" Value="False">
                                                <Setter Property="Background" Value="{StaticResource CalledPresetBrush}"/>
                                                <Setter Property="Foreground" Value="White"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
                    </Viewbox>
                </Grid>
            </Grid>
        </Grid>

        <!-- 操作ボタン領域 -->
        <Grid Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
        </Grid>
        
        <!-- プリセット以降のコンテンツ（カメラタイプに応じてテンプレート切り替え） -->
        <ContentControl Content="{Binding}">
            <ContentControl.Style>
                <Style TargetType="ContentControl">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsCamera1Selected}" Value="True">
                            <Setter Property="ContentTemplate" Value="{StaticResource AiCameraTemplate}"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsCamera1Selected}" Value="False">
                            <Setter Property="ContentTemplate" Value="{StaticResource NormalCameraTemplate}"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ContentControl.Style>
        </ContentControl>
    </StackPanel>
</UserControl>